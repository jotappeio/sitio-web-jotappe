name: Centinela de Seguridad Jotappe

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch: # ESTO ACTIVA EL BOTÓN AZUL

jobs:
  security-patrol:
    runs-on: ubuntu-latest
    steps:
      - name: Verificar con Seguimiento de Redirección
        id: check
        run: |
          # Usamos -L para seguir el salto 307 que vemos en tu Telegram
          STATUS=$(curl -o /dev/null -s -L -w "%{http_code}\n" https://jotappe.com)
          echo "STATUS_CODE=$STATUS" >> $GITHUB_ENV
          if [ "$STATUS" -eq 200 ]; then
            echo "RESULT=OK" >> $GITHUB_ENV
          else
            echo "RESULT=FAIL" >> $GITHUB_ENV
          fi

      - name: Enviar Reporte a Telegram
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            ✅ CENTINELA JOTAPPE: REVISIÓN LISTA
            Dominio: jotappe.com
            Estado Final: ${{ env.STATUS_CODE }}
            Resultado: ${{ env.RESULT }}
            
            Logística: El sistema ha verificado el sitio siguiendo las redirecciones técnicas.
